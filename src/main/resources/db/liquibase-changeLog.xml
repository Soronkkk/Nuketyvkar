<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <!--Messages table-->
    <changeSet id="Koloyartsev-1" author="Koloyartsev V.A.">
        <createTable tableName="messages">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="message_text" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!--Messages data set-->
    <changeSet id="Koloyartsev-2" author="Koloyartsev V.A.">
        <insert tableName="messages">
            <column name="id" value="1"/>
            <column name="message_text" value="Message ONE"/>
        </insert>
        <insert tableName="messages">
            <column name="id" value="2"/>
            <column name="message_text" value="Message TWO"/>
        </insert>
        <insert tableName="messages">
            <column name="id" value="3"/>
            <column name="message_text" value="Message THREE"/>
        </insert>
        <insert tableName="messages">
            <column name="id" value="4"/>
            <column name="message_text" value="Message FOUR"/>
        </insert>
        <insert tableName="messages">
            <column name="id" value="5"/>
            <column name="message_text" value="Message FIVE"/>
        </insert>
    </changeSet>

    <!--Person table-->
    <changeSet id="Koloyartsev-3" author="Koloyartsev V.A.">
        <createTable tableName="person">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="username" type="VARCHAR(64)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(128)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>

    <!--Person table data set-->
    <changeSet id="Koloyartsev-4" author="Koloyartsev V.A.">
        <insert tableName="person">
            <column name="username" value="user"/>
            <column name="password" value="$2a$10$aXpu1lorpayTSJeOYCxQcOWyoGBr6dEEj475OfuXPojnbAKFsEWFi"/>
            <column name="email" value="user@email.com"/>
        </insert>
        <insert tableName="person">
            <column name="username" value="moder"/>
            <column name="password" value="$2a$10$aXpu1lorpayTSJeOYCxQcOWyoGBr6dEEj475OfuXPojnbAKFsEWFi"/>
            <column name="email" value="moder@email.com"/>
        </insert>
        <insert tableName="person">
            <column name="username" value="admin"/>
            <column name="password" value="$2a$10$aXpu1lorpayTSJeOYCxQcOWyoGBr6dEEj475OfuXPojnbAKFsEWFi"/>
            <column name="email" value="admin@email.com"/>
        </insert>
    </changeSet>

    <!--https://github.com/Soronkkk/Nuketyvkar/issues/7-->
    <!--roles table-->
    <changeSet id="Glebov-1" author="Seri4">
        <createTable tableName="roles">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!--person_roles table-->
    <changeSet id="Glebov-2" author="Seri4">
        <createTable tableName="person_roles">
            <column name="person_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_person" references="person(id)"/>
            </column>
            <column name="role_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_role" references="roles(id)"/>
            </column>
        </createTable>
    </changeSet>

    <!--Roles data insert-->
    <changeSet id="Glebov-3" author="Seri4">
        <insert tableName="roles">
            <column name="name" value="ROLE_ADMIN"/>
        </insert>
        <insert tableName="roles">
            <column name="name" value="ROLE_MODERATOR"/>
        </insert>
        <insert tableName="roles">
            <column name="name" value="ROLE_USER"/>
        </insert>
    </changeSet>

    <!-- person_roles data insert-->
    <changeSet id="Glebov-4" author="Seri4">
        <insert tableName="person_roles">
            <column name="person_id" value="1"/>
            <column name="role_id" value="3"/>
        </insert>
        <insert tableName="person_roles">
            <column name="person_id" value="2"/>
            <column name="role_id" value="2"/>
        </insert>
        <insert tableName="person_roles">
            <column name="person_id" value="2"/>
            <column name="role_id" value="3"/>
        </insert>
        <insert tableName="person_roles">
            <column name="person_id" value="3"/>
            <column name="role_id" value="1"/>
        </insert>
        <insert tableName="person_roles">
            <column name="person_id" value="3"/>
            <column name="role_id" value="2"/>
        </insert>
        <insert tableName="person_roles">
            <column name="person_id" value="3"/>
            <column name="role_id" value="3"/>
        </insert>
    </changeSet>

    <!--    Table messages add new collumns -->
    <changeSet id="Koloyartsev-5" author="Koloyartsev V.A.">
        <addColumn tableName="messages">
            <column name="user_id" type="BIGINT" value="1">
                <constraints referencedTableName="person"/>
            </column>
        </addColumn>
        <addColumn tableName="messages">
            <column name="created_date_time" type="TIMESTAMP" value="2019-01-01"/>
        </addColumn>
    </changeSet>

    <changeSet id="Koloyartsev-6" author="Koloyartsev V.A.">
        <addForeignKeyConstraint constraintName="fk_message_person"
                                 baseTableName="messages" baseColumnNames="user_id"
                                 referencedTableName="person" referencedColumnNames="id"/>
    </changeSet>

<!--    Table messages update collumns-->
    <changeSet id="Koloyartsev-7" author="Koloyartsev V.A">
        <update tableName="messages">
            <column name="created_date_time" value="2019-01-01 12:12:00">
            </column>
            <column name="message_text" value="Кирилл где десигн?">
            </column>
            <where>
                id = 1
            </where>
        </update>
        <update tableName="messages">
            <column name="created_date_time" value="2019-01-01 13:11:14">
            </column>
            <column name="message_text" value="..ходят слухи, что будет андроид версия.. Но это только слухи">
            </column>
            <where>
                id = 2
            </where>
        </update>
        <update tableName="messages">
            <column name="created_date_time" value="2019-01-01 14:01:15">
            </column>
            <column name="message_text" value="Ребят, вы где все?..">
            </column>
            <where>
                id = 3
            </where>
        </update>
        <update tableName="messages">
            <column name="created_date_time" value="2019-01-01 16:05:17">
            </column>
            <column name="message_text" value="Я что здесь один?..">
            </column>
            <where>
                id = 4
            </where>
        </update>
        <update tableName="messages">
            <column name="created_date_time" value="2019-01-01 18:03:12">
            </column>
            <column name="message_text" value="сейчас бы егермейстер навернуть с апельсинчиком и корицей">
            </column>
            <where>
                id = 5
            </where>
        </update>
    </changeSet>

</databaseChangeLog>